<%- model_class = Post -%>
<% title @post.cached_title + " | " + @post.cached_blog.cached_title %>
<div class="row">
  <div class="span6 offset3 dynamicspan">
    <h1 class="page-header title" style="margin-bottom: 20px">
      <%= link_to @post.cached_blog.cached_title, blog_posts_path %>
      <%= link_to "", request.protocol + request.host_with_port + blog_path(@post.cached_blog) + "/feed", :class => "icon-rss", :title => "Subscribe to feed", :style => "font-size: 65%"  %><br>
      <small class="blog-subtitle"><%=  @post.cached_blog.cached_subtitle %></small>
    </h1>
  </div>
</div>
<!-- Main Blog Content -->
<div class="row">
  <div class="span6 offset3 dynamicspan" role="content">
    <article style="margin-top: 20px">
      <h4 class="post-series span2 visible-desktop post-series-sidebar"><%= @post.cached_series_title %></h4>
      <h4 class="post-series hidden-desktop"><%= @post.cached_series_title %></h4>
      <h2><a href="#"><%= link_to @post.cached_title,  blog_post_path(@post.cached_blog,@post) %></a></h2>
      <h4 class="post-subtitle"><%= @post.cached_subtitle %></h4>
      <div>
        <span class="pull-right">
          <% if can? :destroy, @post.cached_blog %>
          <%= link_to 'Edit', edit_blog_post_path(@post.cached_blog,@post), :class => 'btn btn-mini btn-warning' %>
          <% end %>
          <% if can? :destroy, @post %>
          <%= link_to 'Delete', blog_post_path(@post.cached_blog,@post),
          :method => :delete,
          :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
          :class => 'btn btn-mini btn-danger' %>
          <% end %>
        </span>
        <h5 class="blog-author">by <%= link_to @post.cached_blog.cached_user.cached_username, @post.cached_blog.cached_user, {:class => "underline"} %> on <%= @post.cached_published_at.strftime("%a, %b %d %Y at %l:%M %p") %> / <%= link_to (pluralize @post.cached_comments_count, "comment"), "#comments", {:class => "underline"} %>
        </h5>
      </div>
      <div class="main-content">
        <% if @post.show_excerpt === "prefix" %>
          <p><%= @post.cached_excerpt %></p>
        <% end %>
        <%= @post.cached_content.html_safe.gsub(/\r\n?/,"").html_safe %>
        <% if @post.show_excerpt === "suffix" %>
          <p><%= @post.cached_excerpt %></p>
        <% end %>
      </div>
      <% if @post.updated_at > @post.published_at + 20 %>
      <p class="author muted" style="padding-top: 20px">
        (Updated on <%= @post.updated_at.strftime("%b %d %Y at %l:%M %p") %>)
      </p>
      <% end %>
      <% tag_counts = @post.tag_counts %>
      <% if tag_counts.length > 0 %>
      <div class="tags hidden-desktop">
        <% unless tag_counts.length > 1 %>
        <span class="label">Tag</span>
        <% else %>
        <span class="label">Tags</span>
        <% end %>
        <% tag_cloud tag_counts, %w[m] do |tag| %>
        <span><%= link_to tag.name, tag_path(params[:blog_id],tag.name), :class => "tag label label-info" %></span>
        <% end %>
      </div>
      <% end %>
    </article>
    <% unless @post.draft %>
    <section class="comments">
      <h3 id="comments"><%= pluralize(@post.cached_comments_count, "comment") %></h3>
      <%= render @post.cached_comments %>
      <% if user_signed_in? %>
      <% if can? :create, Comment %>
      <%= render "comments/form" %>
      <% end %>
      <% else %>
      <div class="btn-grp" style="text-align: center">
        <%= link_to "Log in to comment", new_user_session_path, :class => 'btn' %>
      </div>
      <% end %>
    </section>
    <% end %>
  </div>
  <!-- Main Blog Content End -->
  <!--  SideBar Begin -->
  <div class="span3 visible-desktop">
    <% tag_counts = @post.tag_counts %>
    <% if tag_counts.length > 0 %>
    <div class="right-sidebar" id="tag_cloud">
      <label for="related-tag" class="sidebar-title"><span class="label">Tags</span></label>
      <input class="arcin" type="checkbox" id="related-tag" /> 
      <ol>
        <% count = 0 %>
        <li class="listi">
          <% tag_cloud tag_counts, %w[m] do |tag, css_class| %>
          <%= link_to tag_path(params[:blog_id], tag.name) do %>
          <span class="sidebar-links <%= css_class %>"><%= tag.name %></span>
          <% end %>
          <% unless count == tag_counts.length - 1 %>
          <span class="tag-sep">&bull;</span>
          <% end %>
          <% count += 1 %>
          <% end %>
        </li>
      </ol>
    </div>
    <% end %>
  </div>
</div>
<!--  SideBar End -->
</div>
