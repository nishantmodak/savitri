<!-- dynamic fetch of books and cantos -->
<div class="row rowread">
  <div class="span3">
  <div class="accordion" id="accordion2">
      <% Book.all.each do |book| %>
      <div class="accordion-group  hidden-phone">
            <div class="accordion-heading">
              <a class="accordion-toggle collapsed navbook" data-toggle="collapse" data-parent="#accordion2" href="#collapse<%= book.id %>" id="bk1"><%= book.name %></a>
            </div>
            <div id="collapse<%= book.id %>" class="accordion-body collapse">
              <div class="accordion-inner">
                  <ul class="nav nav-tabs nav-stacked navcanto">
                  <% book.cantos.each do |canto| %>
                    <li id="leftnav dropdown-submenu" class="dropdown-submenu">
                      <a  href="<%= '/read/'+book.id.to_s+"/"+canto.id.to_s+"/1" %>", class="<%= is_active_link params,book.id.to_s,canto.id.to_s %>"><%= canto.title %></a>
                        <ul id="roundcorner" class="dropdown-menu visible-desktop;">
                           <% canto.sections.each do |section| %>
                          <li class="<%= is_active_section params,section.runningno.to_s,canto.no.to_s %>" >
                            <%= link_to 'Section '+ section.runningno.to_s + ' ('+ section.no.to_s + ')',"/read/" + @canto.book.no.to_s + "/" +canto.no.to_s + "/" + section.runningno.to_s %>
                           </li>
                          <% end %>
                          </ul>
                    </li>
                    <% end %> 
                    </ul>
              </div>
            </div>
          </div>
        <% end %>
</div>
<div class="hidden-desktop" id="cantos">
  <h4 class="sectionno">
    <span class="dropdown">
      <a class="dropdown-toggle" id="dropsection" data-toggle="dropdown" href="#">
          <span class="sectionlbl" style="display:none">Book</span>
            <%= params[:book_id]%>
          <span class="caret"></span>
      </a>
  <ul class="dropdown-menu sectionlist">
    <% Book.all.each do |book| %>
    <li>
     <%= link_to 'Book '+book.no.to_s, '/read/'+book.no.to_s+'/1/1' %>
    </li>
    <% end %>
    <!-- dropdown menu links -->
  </ul>
  </h4>
</div>
<div class="hidden-desktop" id="cantos">
  <h4 class="sectionno">
                 <span class="dropdown">
    <a class="dropdown-toggle" id="dropsection" data-toggle="dropdown" href="#">
          <span class="sectionlbl" style="display:none">Canto</span>
          <%= params[:canto_id]%>
          <span class="caret"></span>
    </a>
  <ul class="dropdown-menu sectionlist" role="menu" aria-labelledby="dropsection">
  <% Book.find(params[:book_id]).cantos.each do |canto| %>
                    <li role="presentation">
                    <%= link_to 'Canto '+canto.no.to_s, '/read/'+params[:book_id].to_s+'/'+canto.no.to_s + '/1' %>
                    <% end %>
                    </li>
                                   
    <!-- dropdown menu links -->
  </ul>
</div>
  </h4>
   </div>


<!-- '/read/'+bookid.to_s+'/'+cantoid.to_s+'/'+sectionrunningno.to_s+'#'+query[1] -->
  <div class="span6">
         <div id="cantos" class="tab-content">
          <hr class="hidden-desktop"></hr>
      <% unless @stanzas.blank? %>
        <% @canto = Canto.find(Section.find(@stanzas.first.section).canto_id) %>
        <h3 class="cantono visible-desktop">Canto <%= @canto.no %></h3>
        <h2 class="cantoname"><%= @canto.title %></h2>
          <div class="sections">
          <h4 class="sectionno ">
            <% if @canto.sections.length > 1 %>
              <span class="dropdown">
                <a class="dropdown-toggle" id="dropsection" role="button" data-toggle="dropdown" data-target="#" href="#">
                  <span class="sectionlbl" style="display:none">Section</span>
                  <%= params[:section_id] + " (" + @canto.sections.where(:runningno=>params[:section_id]).first.no.to_s + ")" %>
                  <b class="caret"></b>
                </a>
                <ul class="dropdown-menu sectionlist" role="menu" aria-labelledby="dropsection">
                  <% @canto.sections.each do |section| %>
                    <li role="presentation">
                      <%= link_to "/read/" + @canto.book.no.to_s + "/" + @canto.no.to_s + "/" + section.runningno.to_s do %>
                        Section <%= section.runningno.to_s + " (" + @canto.sections.where(:runningno=>section.runningno).first.no.to_s + ")" %>
                      <% end %>
                    </li>
                    <% end %>
                </ul>
              </span>
            <% else %>
              <span class="sectionlbl" style="display:none">Section</span>
              <%= params[:section_id] + " (" + @canto.sections.where(:runningno=>params[:section_id]).first.no.to_s + ")" %>
            <% end %>
          </h4>
           
          <div id="content">
            <div id="s<%= params[:section_id] %>" class="section">
              <p><%= render @stanzas %></p>
            </div>
          </div>
        </div>
      <% else %>
        <h2><%= @canto.title %></h2>
      <% end %>
    </div>
      
              
<script type="text/javascript">
  //show the static text "Section" after page load
  $(".sectionlbl").show();

  //start color animation after page load
  if (window.location.hash) {
    var hashvalue = "p" + window.location.hash.split("#")[1];
    
    var currentColor = jQuery.Color("#" + hashvalue);
    
    $("#" + hashvalue).animate({
      backgroundColor: "#FDF1CA"
    }, 1000);
    
    $("#" + hashvalue).animate({
      backgroundColor: currentColor
    }, 3000);
  };
</script>
